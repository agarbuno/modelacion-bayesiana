#+TITLE: EST-46115: Modelaci贸n Bayesiana
#+AUTHOR: Prof. Alfredo Garbuno I帽igo
#+EMAIL:  agarbuno@itam.mx
#+DATE: ~Primavera, 2023~
:REVEAL_PROPERTIES:
#+LANGUAGE: es
#+OPTIONS: num:nil toc:nil timestamp:nil
#+REVEAL_REVEAL_JS_VERSION: 4
#+REVEAL_THEME: night
#+REVEAL_SLIDE_NUMBER: t
#+REVEAL_HEAD_PREAMBLE: <meta name="description" content="Modelaci贸n Bayesiana">
#+REVEAL_INIT_OPTIONS: width:1600, height:900, margin:.2
#+REVEAL_EXTRA_CSS: ./notas/mods.css
#+REVEAL_PLUGINS: (notes)
:END:
#+STARTUP: showall
#+EXCLUDE_TAGS: toc github latex

[[https://github.com/agarbuno/modelacion-bayesiana/actions/workflows/docker.yml/badge.svg]] [[https://img.shields.io/docker/pulls/agarbuno/bayesiana.svg?logo=docker]] [[https://img.shields.io/docker/image-size/agarbuno/bayesiana/notas.svg?logo=docker]] [[https://img.shields.io/github/languages/top/agarbuno/modelacion-bayesiana.svg?logo=r]] [[https://img.shields.io/github/languages/code-size/agarbuno/modelacion-bayesiana.svg?logo=r]] 

* Contenido                                                             :toc:
:PROPERTIES:
:TOC:      :include all  :ignore this :depth 2
:END:
:CONTENTS:
- [[#introducci贸n][Introducci贸n]]
- [[#contexto][Contexto]]
- [[#objetivo][Objetivo]]
- [[#temario][Temario]]
  - [[#de-qu茅-trata-el-curso][驴De qu茅 trata el curso?]]
  - [[#estructura-del-curso][Estructura del curso]]
  - [[#existe-un-libro-de-texto][驴Existe un libro de texto?]]
- [[#recursos][Recursos]]
- [[#horarios][Horarios]]
  - [[#formato][Formato]]
  - [[#canvas][Canvas]]
  - [[#fechas-importantes][Fechas importantes]]
  - [[#atenci贸n-de-alumnos][Atenci贸n de alumnos]]
- [[#evaluaci贸n][Evaluaci贸n]]
  - [[#proyecto-final][Proyecto final]]
- [[#ambiente-de-trabajo][Ambiente de trabajo]]
  - [[#configuraci贸n-r][Configuraci贸n R]]
  - [[#configuraci贸n-renv][Configuraci贸n renv]]
  - [[#trabajando-con-ambiente-dockerizado][Trabajando con ambiente Dockerizado]]
  - [[#configuraci贸n-de-docker][Configuraci贸n de Docker]]
- [[#tareas][Tareas]]
- [[#dudas][驴Dudas?]]
- [[#contribuidores][Contribuidores]]
- [[#bibliograf铆a][Bibliograf铆a]]
:END:

* Introducci贸n                                                       :github:

Este es el repositorio con el contenido del curso en *Modelaci贸n Bayesiana* de la
*maestr铆a en ciencia de datos*. Tambi茅n puede ser ofrecida de manera simult谩nea para alumnos
avanzados en las licenciaturas de matem谩ticas aplicadas, ciencia de datos y
actuar铆a.

#+REVEAL: split
#+begin_quote
Our goal is ~not to eliminate uncertainty~, but to understand and quantify the
uncertainty in order to make sound decisions. ---Netflix Tech Blog
#+end_quote

#+REVEAL: split

#+DOWNLOADED: screenshot @ 2022-01-23 01:22:55
#+attr_html: :width 1200 :align center
[[file:images/20220123-012255_screenshot.png]]

#+REVEAL: split
#+begin_quote
A previous acquaintance with probability and statistics is not necessary;
indeed, a certain amount of innocence in this area may be desirable, because
there will be less to unlearn. ---Jaynes, 2003.
#+end_quote

* Contexto 

Este es el curso ~EST-46115: Temas Selectos de Estad铆stica~. Lo conoceremos como 
~Modelaci贸n Bayesiana~ y corresponde al segundo semestre de la Maestr铆a en Ciencia 
de Datos. 

* Objetivo

En este curso se ver谩n temas avanzados en la visualizaci贸n, simulaci贸n y
diagn贸stico de modelos bayesianos para: inferencia, an谩lisis de potencia y
calibraci贸n de procedimientos estad铆sticos. Se estudiar谩 un flujo de trabajo
bayesiano que permite validar y evaluar hip贸tesis. Se introducir谩n algunos
modelos modernos utilizados en distintas 谩reas como: modelos predictivos,
selecci贸n de variables y sistemas de recomendaci贸n. El material se complementar谩
con algunos /podcasts/ y lecturas de art铆culos de divulgaci贸n e investigaci贸n a lo
largo del curso.
 
* Temario

El temario para el semestre de primavera 2022 se puede encontrar 
[[https://github.com/ITAM-DS/modelacion-bayesiana/blob/spring-2022/docs/temario-modelacion-bayesiana.pdf][aqui]]. 
Este es un plan preliminar que est谩 sujeto al avance del curso a lo largo del semestre. 

** 驴De qu茅 trata el curso?

En esta iteraci贸n del curso se estudiar谩n las ~bases algor铆tmicas~ de la
inferencia bayesiana (m茅todos de simulaci贸n por cadenas de Markov) as铆 como los
~diagn贸sticos~ pertinentes. De igual manera estudiaremos un ~flujo de trabajo~
basado en calibraci贸n y simulaci贸n para poder identificar rutas potenciales de
mejora en nuestros modelos y revisaremos principios basados en el m茅todo
cient铆fico. El curso continuar谩 con m茅todos de ~inferencia aproximada~ que han
dado lugar a aplicaciones del estado de arte como sistemas de recomendaci贸n o
an谩lisis de texto.

** Estructura del curso

El curso est谩 planeado alrededor de tres temas centrales:
#+ATTR_REVEAL: :frag (appear)
1. C贸mputo probabil铆stico.
2. Flujo de trabajo Bayesiano.
3. Modelaci贸n predictiva probabil铆stica. 

** 驴Existe un libro de texto?

#+DOWNLOADED: screenshot @ 2022-01-23 01:11:36
#+attr_html: :width 1200 :align center
[[file:images/20220123-011136_screenshot.png]]

* Recursos

El contenido actual del curso se encuentra en la rama: 
[[https://github.com/agarbuno/modelacion-bayesiana/tree/spring-2023][spring-2023]]. La
estructura del repositorio se muestra a continuaci贸n donde a grandes
razgos tenemos:

#+begin_src bash :exports results :results org :eval never

tree -L 1 -d 

#+end_src

#+RESULTS:
#+begin_src org
.
 docs       # Handouts con las notas de clase
 images     # Material visual de apoyo
 modelos    # Directorio con los modelos que usaremos en el curso
 notas      # Material fuente de las notas (emacs)
 renv       # Archivos de estructura de ambiente (R)
 rscripts   # Codigo de R para interactuar con Stan

6 directories
#+end_src

* Horarios

El curso ser谩 los d铆as Martes y Jueves en el horario

** Formato

El curso ser谩 ~completamente presencial~. Por otro lado, salvo se indique lo
contrario, ~las evaluaciones ser谩n presenciales~.

** Canvas

Utilizaremos este LMS para gestionar la comunicaci贸n fuera de los horarios de
clase. Asimismo, ahi tendr谩n acceso al calendario y las sesiones de zoom que se
necesiten a lo largo del semestre.

** Fechas importantes

#+ATTR_REVEAL: :frag (appear)

** Atenci贸n de alumnos

El horario de atenci贸n a alumnos ser谩 Lunes y Mi茅rcoles en un horario de 11:00am
a 1:00pm. Recomiendo utilizar el sitio de [[https://calendly.com/alfredo-garbuno/entrevistas][calendly]]. Por supuesto, si no les
queda alg煤n horario podemos agendar por ~correo electr贸nico~.

#+DOWNLOADED: screenshot @ 2022-08-09 10:19:38
#+attr_html: :width 700 :align center
[[file:images/20220809-101938_screenshot.png]]

#+REVEAL: split
~Importante~: les estoy proporcionando la facilidad de agendar con plena libertad las
sesiones de asesor铆a. Consideren que al ustedes agendar una reuni贸n est谩n privando ese espacio a 
alguien mas en mis cursos. Asi que por favor no desperdicien ese espacio. 
* Evaluaci贸n

La evaluaci贸n del curso ser谩 por medio de:
#+ATTR_REVEAL: :frag (appear)
- Participaci贸n y tareas (30%)
- Evaluaciones parciales (30%)
- Proyecto final (40%)

** Proyecto final

Trabajo basado en un /paper/, m茅todo, modelo, aplicaci贸n relacionado con la tem谩tica de la clase.
Entregables: 
1. Presentaciones de Seguimiento (25%),
2. Reporte escrito (50%)
3. Presentaci贸n final (25%). 

* Ambiente de trabajo

El curso puede ser seguido en Python, Julia, etc (b谩sicamente cualquier lenguaje de /scripteo/ con interface a ~Stan~). El curso utilizar谩
[[https://mc-stan.org/][Stan]] como lenguaje para definir y ajustar modelos bayesianos (tanto
asint贸ticamente correctos, como aproximados). En particular utilizar茅 la
interfase de [[https://www.r-project.org/][R]] por medio de ~cmdstanr~ pero de igual manera son bienvenidos en
utilizar la interfase de [[https://www.python.org/][python]] o la que les acomode$^\dagger$.

#+REVEAL: split

Como herramienta de trabajo se sugiere utilizar +[[https://www.rstudio.com/products/rstudio/download/][Rstudio]]+ 
[[https://code.visualstudio.com/][Visual Studio Code]] para
poder trabajar en sus proyectos y sus tareas. En particular, el material de
clase es editado en [[https://www.gnu.org/software/emacs/][GNU Emacs]] a trav茅s de =orgfiles= 
(archivos de texto plano con sufijo ~.org~) pero pueden ser visualizados en ~Github~.

#+REVEAL: split

*Nota*: Si van a utilizar ~R~ se recomienda tener instalada la versi贸n ~4.2.1~ para
tener la mejor compatibilidad con el c贸digo del curso.

** Configuraci贸n ~R~

Utilizaremos ~renv~ para mantener actualizada las herramientas de ~R~ junto con el
contenido del curso. En la carpeta principal se encuentran los archivos de
requerimientos (=renv.lock=) con el que podr谩n usar los archivos que se vayan
decantando en la carpeta =rscripts=. A煤n asi, la configuraci贸n se ir谩 refinando
en los ejercicios de tarea que vayamos utilizando en el curso.

** Configuraci贸n ~renv~

Si utilizas ~MacOS~ o alguna distribuci贸n ~Linux~ se recomienda escribir en el
archivo ~~/.Renviron~ la siguiente l铆nea lo cual mantendr谩 el cache de ~renv~ en un
lugar centralizado y de f谩cil acceso:

#+begin_src conf :tangle ~/.Renviron :mkdirp yes
  RENV_PATHS_ROOT=~/.renv
#+end_src

** Trabajando con ambiente ~Dockerizado~

Las im谩genes de ~agarbuno/bayesiana~ (puedes ver im谩genes en mi hub de Docker
[[https://hub.docker.com/repository/docker/agarbuno/bayesiana][aqui]], y/o los 
~Dockerfiles~ [[https://github.com/agarbuno/dockerfiles][aqui]]) permiten tener un ambiente para trabajar con
~Docker~ en nuestro curso.

#+REVEAL: split
Mi idea de ambiente computacional es el que se puede reproducir en cualquier
sistema operativo. Para esto ~Docker~ es la herramienta ideal y el uso de los
~Codespaces~ de GitHub ha resultado incre铆ble para una soluci贸n dentro de un
谩mbito educativo.

#+REVEAL: split
Para la imagen ~agarbuno/bayesiana~ consideren que: 
1) El /tag/ ~notas~ basado en una distribuci贸n linux en una emulaci贸n con un
   procesador ~Intel~, tiene la configuraci贸n m铆nima necesaria para poder
   reproducir el ambiente de c贸mputo para poder ejecutar el material del curso.

#+REVEAL: split
La idea es que si usamos el combo ~Docker~ + ~Visual Code Studio~, entonces 隆tod@s tenemos la misma computadora para trabajar! ゲ.  
Y si lo quieren correr en la nube entonces: ~Docker~ + ~Visual Code Studio~ + ~Github Codespaces~ ゲ $\times 10^{78}$.

#+REVEAL: split
~Importante~: Si espero que sepan reproducir ustedes la configuraci贸n del ambiente de 
trabajo. Parte del curso contemplar谩 organizar una sesi贸n para discutir esto a profundidad.
De momento, lo importante es que lo sepan utilizar en su computadora o en un explorador de internet.
Esto es, que pueden utilizarlo para las pr谩cticas del curso. 

#+REVEAL: split
Esta imagen provee de un ambiente donde se podr谩n instalar las paqueter铆as que
utilizaremos sin ning煤n problema$^\dagger$. La idea, adicional, es que utilicemos
/volumes/ para poder tener permanencia en nuestro trabajo.

#+REVEAL: split
El contenedor se podr谩 levantar sin ning煤n problema por medio de la siguiente
serie de instrucciones en terminal (tambi茅n se puede establecer un script de
/shell/).

#+begin_src shell
  # Ruta del cache de renv en el contenedor
  RENV_PATHS_CACHE_CONTAINER=/home/rstudio/.renv
  # Ruta del cache de renv en tu maquina
  RENV_PATHS_CACHE_HOST=~/.renv/cache
  # Ruta donde guardes los clones de las tareas
  PATH_TRABAJO_HOST=<ruta hacia las carpetas de los repos de tareas>

  docker run -p 8787:8787 \
      -e PASSWORD=<contrase帽a de tu preferencia> \
      -e "RENV_PATHS_CACHE=${RENV_PATHS_CACHE_CONTAINER}" \
      -e "RENV_PATHS_ROOT=${RENV_PATHS_CACHE_CONTAINER}" \
      -v "${RENV_PATHS_CACHE_HOST}:${RENV_PATHS_CACHE_CONTAINER}" \
      -m 6g \ 
      -v "${PATH_TRABAJO_HOST}:/home/rstudio/documentos" \
      agarbuno/bayesiana:<tag>
#+end_src

** Configuraci贸n de ~Docker~                                          :github:

La im谩gen de Docker para el ambiente de RStudio est谩 basada en la imagen de
[[https://hub.docker.com/r/rocker/tidyverse][rocker/verse]] de los desarrolladores en el [[https://www.rocker-project.org/][Proyecto de Rocker]] con las
siguientes herramientas agregadas para la materia de modelaci贸n bayesiana:

- [[https://cran.r-project.org/web/packages/posterior/index.html][posterior]]
- [[https://cran.r-project.org/web/packages/bayesplot/index.html][bayesplot]]
- [[https://github.com/mjskay/tidybayes][tidybayes]]
- [[https://mc-stan.org/users/interfaces/cmdstan][cmdstan]]
- [[https://mc-stan.org/cmdstanr/][cmdstanr]]
- [[languageserver]]
- [[httpgd]]

Para instrucciones de uso, se sugiere seguir la [[https://github.com/rocker-org/rocker/wiki/Using-the-RStudio-image][Documentaci贸n de Rocker]]

Un ejemplo de como construir y correr este contenedor ser铆a lo siguiente. En un
terminal, dentro del folder del repo, correr la siguiente l铆nea

#+begin_src shell :exports code :results none
  docker build --tag bayesiana:notas .
#+end_src

El contenedor lo podemos despertar con

#+begin_src shell
  docker run -e PASSWORD=qwerty -p 8787:8787 --rm bayesiana:notas
#+end_src

Para vistarlo basta con utilizar la ruta ~localhost:8787~ en cualquier /browser/ de
internet y utilizar la contrase帽a especificada. Se puede agregar la bandera de
~-v~ si se quiere acceder a un folder local. Mas informaci贸n de vol煤menes se
pueden encontrar en la [[https://docs.docker.com/storage/volumes/][documentaci贸n]].

* Tareas 

Las primeras tareas del semestre son b谩sicamente configuraci贸n y es recomendable
hacerlas si no cuentan con experiencia en: ~Git~, ~Github~, ~R~ y el ~tidyverse~.

Las tareas las gestionaremos a trav茅s de ~Github Classroom~ lo cual me permite
administrar sus entregas como proyectos de ~Git~. Adem谩s, habr谩 ejercicios de las
tareas que tendr谩n mecanismos de calificaci贸n automatizada.

#+REVEAL: split
#+DOWNLOADED: screenshot @ 2022-06-24 18:23:16
#+attr_html: :width 400 :align center
[[file:images/20220624-182316_screenshot.png]]

* 驴Dudas?

* Contribuidores                                                     :github:

[[https://github.com/AdrianTJ][AdrianTJ]] (ambiente en ~Docker~). 

* Bibliograf铆a                                                        :latex:
\nocite{*}
bibliographystyle:abbrvnat
bibliography:references.bib

* COMMENT Plan de trabajo [10/15][66%]                             :noexport:
:PROPERTIES:
:UNNUMBERED: notoc
:END:
** DONE Repaso 
CLOSED: [2022-03-04 Fri 19:42]
** DONE Integraci贸n numerica
CLOSED: [2022-03-04 Fri 19:43]
** DONE MCMC (Parte 1)
CLOSED: [2022-03-04 Fri 19:43]
** DONE MCMC (Parte 2)
CLOSED: [2022-03-04 Fri 19:43]
** DONE HMC
CLOSED: [2022-03-04 Fri 19:43]
** DONE Diagnosticos
CLOSED: [2022-03-15 Tue 20:19]
** DONE Posterior Predictive Sampling
CLOSED: [2022-04-07 Thu 16:51]
** DONE Posterior and prior predictive checks
CLOSED: [2022-04-07 Thu 16:51]
** DONE Simulation Based calibration
CLOSED: [2022-05-02 Mon 16:26]
** DONE Evaluation and cross validation
CLOSED: [2022-05-02 Mon 16:26]
** TODO Decision Analysis
** TODO Poststratification
** TODO Clustering
** TODO Item response theory 
** TODO Variational inference


* COMMENT Posibles temas                                           :noexport:
:PROPERTIES:
:UNNUMBERED: notoc
:END:
** TODO Multi-Armed Bandits
Tomar el caso en [[https://www.smartly.io/blog/tutorial-how-we-productized-bayesian-revenue-estimation-with-stan][Smartly.io]] o tambi茅n [[https://www.linkedin.com/pulse/tutorial-how-we-productized-bayesian-revenue-estimation-markus-ojala/][aqui]]. Comentarios por [[https://statmodeling.stat.columbia.edu/2018/01/21/smartly-io-productized-bayesian-revenue-estimation-stan/][Andrew Gelman]]. 
** TODO SIR modeling 
Tomar el caso en [Grenable, Stan tutorial]. 

Referencia muy general [[https://michaeldewittjr.com/dewitt_blog/posts/2020-08-28-bayesian-sir/][Michael DeWitt: Bayesian SIR]]. El caso mas completo aqui: [[https://mc-stan.org/users/documentation/case-studies/boarding_school_case_study.html][Bayesian workflow for disease transmission modeling in Stan]]. Referencia de Grenable: [[https://www.generable.com/post/fitting-a-basic-sir-model-in-stan][Fitting a Basic SIR Model in Stan]]. 

citep:Kusmierczyk2019a
